<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <style>
        body { font-family: 'Helvetica Neue', Helvetica; font-weight: 300; padding: 20px;
        text-align: center;}
        th { text-align: left; }
        th, td { padding: 0 1em 0.5ex 0;}
        th, td { text-align: center; }
        table {border-collapse: collapse;}
        table, th, td {border: 1px solid black}
        table {
            margin-left:auto; 
            margin-right:auto;
        }
    </style>
  </head>
  
  <body>
    <h1>Try Tables</h1>
    <button type="button" id="under1">Under 1 year</button>
    <button type="button" id="b1to4">1 - 4 years</button>
    <button type="button" id="b5to14">5 - 14 years</button>
    <button type="button" id="b15to24">15 - 24 years</button>
    <button type="button" id="b25to44">25 - 44 years</button>
    <button type="button" id="b45to64">45 - 64 years</button>   
    <button type="button" id="b64over">65 years and over</button>
    <br/><br/>

    <table>
        <tr>
            <th>Pie Chart for Year 1980</th>
            <th>Pie Chart for Year 2016</th>
        </tr>
        <tr>
            <td><div id='pie1980'></div></td>
            <td><div id='pie2016'></div></td>
        </tr>
    </table><br/><br/>
    
    <script>
    var width = 450
    height = 450
    margin = 10

    // The radius of the pieplot is half the width or half the height (smallest one). I subtract a bit of margin.
    var radius = Math.min(width, height) / 2 - margin;

// append the svg object to the div called 'my_dataviz'
    var svg1980 = d3.select("#pie1980")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var svg2016 = d3.select("#pie2016")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g")
        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

    var dataset, all, mode;
    var color = d3.scaleOrdinal()
        .domain([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
        .range(d3.schemePaired);

      d3.json('Data/tabledata.json', function(data) {
        dataset = data.slice(0, 10);
        all = data;
        mode = 'under1';
        drawTable();
        drawPieChart();
      });

      function drawPieChart() {
          //For 1980
            var pie = d3.pie()
                .value(function(d) {return +d['Deaths_1980']})
                .sort(null);

            var data_ready = pie(dataset);

            var u = svg1980.selectAll('path')
                .data(data_ready);

            u.enter()
            .append('path')
            .merge(u)
            .transition()
            .duration(800)
            .attr('d', d3.arc()
            .innerRadius(0)
            .outerRadius(radius - 70))
            .attr('fill', function(d){ return(color(d.data['Rank'])) })
            .attr("stroke", "white")
            .style("stroke-width", "1px")
            .style("opacity", 1);

            u.exit().remove();


            //For 2016
            var pie2 = d3.pie()
                .value(function(d) {return +d['Deaths_2016']})
                .sort(null);

            var data_ready2 = pie2(dataset);

            var u2 = svg2016.selectAll('path')
                .data(data_ready2);

            u2.enter()
            .append('path')
            .merge(u2)
            .transition()
            .duration(1000)
            .attr('d', d3.arc()
            .innerRadius(0)
            .outerRadius(radius - 70))
            .attr('fill', function(d){ return(color(d.data['Rank'])) })
            .attr("stroke", "white")
            .style("stroke-width", "1px")
            .style("opacity", 1);

            u2.exit().remove();

      };


      function drawTable() {
        var table = d3.select('body').append('table');
        var headers = table.append('tr');

        var tr = table.selectAll('tr.data')
            .data(dataset)
            .enter()
            .append('tr');

        headers.append('th').text('Category');
        headers.append('th').text('Rank');
        headers.append('th').text('Causes of Death in 1980');
        headers.append('th').text('No. of Deaths in 1980');
        headers.append('th').text('Causes of Deaths in 2016');
        headers.append('th').text('No. of Deaths in 2016');

        tr.append('td').attr('class', 'category')
            .text(function(d) {if(d['index']%10 == 1) {return d['Category']} else {return d['Rank']}})
            .attr("rowspan", function(d) {if(d['index']%10 == 1) return 10});
        
        tr.append('td').attr('class', 'rank')
            .text(function(d) {if(d['index']%10 == 1) {return d['Rank']} else {return d['Cause_1980']}});

        tr.append('td').attr('class', 'cause1980')
            .text(function(d) {if(d['index']%10 == 1) {return d['Cause_1980']} else {return d['Deaths_1980']}});

        tr.append('td').attr('class', 'deaths1980')
            .text(function(d) {if(d['index']%10 == 1) {return d['Deaths_1980']} else {return d['Cause_2016']}});

        tr.append('td').attr('class', 'cause2016')
            .text(function(d) {if(d['index']%10 == 1) {return d['Cause_2016']} else {return d['Deaths_2016']}});

        tr.append('td').attr('class', 'deaths2016')
            .text(function(d) {if(d['index']%10 == 1) {return d['Deaths_2016']}})
            .style('padding', function(d) {if(d['index']%10 != 1) {return 0}});
      };

      d3.select('#under1').on('click', function() {
        if(mode != 'under1'){
            dataset = all.slice(0, 10);
            mode = 'under1';
            filterTable();
            drawPieChart();
        }
    });

    d3.select('#b1to4').on('click', function() {
        if(mode != 'b1to4'){
            dataset = all.slice(10, 20);
            mode = 'b1to4';
            filterTable();
            drawPieChart();
        }
    });

    d3.select('#b5to14').on('click', function() {
        if(mode != 'b5to14'){
            dataset = all.slice(20, 30);
            mode = 'b5to14';
            filterTable();
            drawPieChart();
        }
    });

    d3.select('#b15to24').on('click', function() {
        if(mode != 'b15to24'){
            dataset = all.slice(30, 40);
            mode = 'b15to24';
            filterTable();
            drawPieChart();
        }
    });

    d3.select('#b25to44').on('click', function() {
        if(mode != 'b25to44'){
            dataset = all.slice(40, 50);
            mode = 'b25to44';
            filterTable();
            drawPieChart();
        }
    });

    d3.select('#b45to64').on('click', function() {
        if(mode != 'b45to64'){
            dataset = all.slice(50, 60);
            mode = 'b45to64';
            filterTable();
            drawPieChart();
        }
    });


    d3.select('#b64over').on('click', function() {
        if(mode != 'b64over'){
            dataset = all.slice(60, 70);
            mode = 'b64over';
            filterTable();
            drawPieChart();
        }
    });



      function filterTable() {
        d3.selectAll('.category')
            .data(dataset).transition().duration(1000)
            .text(function(d) {if(d['index']%10 == 1) {return d['Category']} else {return d['Rank']}})
            .attr("rowspan", function(d) {if(d['index']%10 == 1) return 10});

        d3.selectAll('.rank')
            .data(dataset).transition().duration(1000)
            .text(function(d) {if(d['index']%10 == 1) {return d['Rank']} else {return d['Cause_1980']}});

        d3.selectAll('.cause1980')
            .data(dataset).transition().duration(1000)
            .text(function(d) {if(d['index']%10 == 1) {return d['Cause_1980']} else {return d['Deaths_1980']}});

        d3.selectAll('.deaths1980')
            .data(dataset).transition().duration(1000)
            .text(function(d) {if(d['index']%10 == 1) {return d['Deaths_1980']} else {return d['Cause_2016']}});

        d3.selectAll('.cause2016')
            .data(dataset).transition().duration(1000)
            .text(function(d) {if(d['index']%10 == 1) {return d['Cause_2016']} else {return d['Deaths_2016']}});

        d3.selectAll('.deaths2016')
            .data(dataset).transition().duration(1000)
            .text(function(d) {if(d['index']%10 == 1) {return d['Deaths_2016']}})
            .style('padding', function(d) {if(d['index']%10 != 1) {return 0}});
      }
    </script>
  </body>
</html>